/*-- scss:defaults --*/

/* Base Bootswatch */
$theme: "litera";

/* ===================================================================
   WEB FONTS - Importazione centralizzata
   =================================================================== */

/* Fira Code per monospace con ligature */
@import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap');

/* Font serif di fallback Google Fonts (opzionale per compatibilità) */
/*
 @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap');
*/

/* ===================================================================
   VARIABILI TIPOGRAFICHE
   =================================================================== */

/* Dimensioni base */
$font-size-root: 19px;

/* Stack font organizzati per gerarchia */
$font-family-serif-primary: "Palatino nova Pro", "Palatino", Georgia, "Times New Roman", serif;
$font-family-serif-display: "Palatino nova Pro", "Palatino", serif; // Per drop caps e elementi decorativi
$font-family-sans-serif: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Noto Sans", sans-serif;
$font-family-monospace: "Fira Code", "SF Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

/* Assegnazione ruoli tipografici */
$font-family-base: $font-family-serif-primary;
$headings-font-family: $font-family-serif-primary;

/* ===================================================================
   SCALA TIPOGRAFICA ARMONIOSA
   =================================================================== */

/* Rapporti matematici per scala coerente */
$ratio-golden: 1.618;
$ratio-perfect-fourth: 1.333;
$ratio-major-third: 1.25;
$ratio-minor-third: 1.2;

/* Scala titoli mantenendo le dimensioni attuali ma più coerente */
$h1-size-min: 2.0rem;
$h1-size-max: 2.4rem; // Ridotto da 2.55rem
$h2-size-min: 1.6rem;
$h2-size-max: 1.9rem; // Ridotto da 2.0rem  
$h3-size-min: 1.34rem;
$h3-size-max: 1.5rem; // Ridotto da 1.58rem
$h4-size: 1.2rem; // Ridotto da 1.25rem
$h5-size: 1.1rem;
$h6-size: 1rem;

/* ===================================================================
   VARIABILI COLORE - PALETTE "CARTA ANTICA"
   =================================================================== */

/* Colori base per look "manoscritto rinascimentale" */
$paper-warm: #fdfcf8;        // Carta antica
$paper-cream: #f8f6f0;       // Crema per sfondi delicati
$text-primary: #2d2926;      // Inchiostro seppia scuro
$text-secondary: #5d5349;    // Testo secondario caldo
$text-muted: #8b8680;        // Testo attenuato
$accent-warm: #8B4513;       // Marrone sella per accenti
$accent-light: #A0522D;      // Sienna per rubriche

/* Variabili per bordi e ombre */
$border-warm: color-mix(in srgb, #{$text-primary} 20%, transparent);
$border-light: color-mix(in srgb, #{$text-primary} 12%, transparent);
$shadow-subtle: rgba(0, 0, 0, 0.03);

/*-- scss:rules --*/

/* ===================================================================
   VARIABILI CSS DINAMICHE
   =================================================================== */

:root {
  /* Font stacks */
  --bs-font-serif: #{$font-family-serif-primary};
  --bs-font-sans-serif: #{$font-family-sans-serif};
  --bs-font-monospace: #{$font-family-monospace};
  --bs-body-font-family: var(--bs-font-serif);
  
  /* Colori */
  --bs-body-bg: #{$paper-warm};
  --bs-body-color: #{$text-primary};
  --bs-secondary-color: #{$text-secondary};
  --bs-muted-color: #{$text-muted};
  --bs-link-color: #{color-mix(in srgb, $text-primary 70%, $accent-warm)};
  --bs-link-hover-color: #{$text-primary};
  
  /* Spaziature basate su rapporto aureo */
  --space-xs: 0.382rem;    /* φ⁻² */
  --space-sm: 0.618rem;    /* φ⁻¹ */
  --space-md: 1rem;        /* base */
  --space-lg: 1.618rem;    /* φ */
  --space-xl: 2.618rem;    /* φ² */
  --space-xxl: 4.236rem;   /* φ³ */
  
  /* Accenti decorativi */
  --accent-warm: #{$accent-warm};
  --accent-light: #{$accent-light};
  --border-warm: #{$border-warm};
  --paper-cream: #{$paper-cream};
}

/* ===================================================================
   TIPOGRAFIA BASE - CORPO TESTO
   =================================================================== */

body {
  font-family: var(--bs-body-font-family);
  background-color: var(--bs-body-bg);
  color: var(--bs-body-color);
  
  /* Ottimizzazioni rendering */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
  
  /* Feature tipografiche avanzate */
  font-variant-ligatures: common-ligatures discretionary-ligatures;
  font-variant-numeric: oldstyle-nums proportional-nums;
  font-kerning: normal;
  
  /* Interlinea armoniosa */
  line-height: 1.618; /* Rapporto aureo per migliore leggibilità */
  
  /* Ottimizzazioni lettura */
  hanging-punctuation: first last;
  text-wrap: pretty; /* Supporto moderno per wrapping intelligente */
}

/* ===================================================================
   SISTEMA TITOLI - GERARCHIA COERENTE
   =================================================================== */

h1, h2, h3, h4, h5, h6 {
  font-family: #{$headings-font-family};
  
  /* Peso e stile uniformi */
  font-weight: 600;
  font-style: normal; /* Rimosso l'italic per migliore leggibilità */
  
  /* Spaziatura verticale armoniosa */
  margin-top: var(--space-xl);
  margin-bottom: var(--space-sm);
  
  /* Ottimizzazioni tipografiche */
  line-height: 1.2;
  letter-spacing: 0.01em;
  text-rendering: optimizeLegibility;
  
  /* Feature avanzate per titoli */
  font-variant-ligatures: common-ligatures discretionary-ligatures;
  font-variant-caps: small-caps; /* Eleganza classica */
  font-variant-numeric: oldstyle-nums proportional-nums;
  
  /* Evita sillabazione nei titoli */
  hyphens: none;
  -webkit-hyphens: none;
  overflow-wrap: normal;
  word-break: normal;
}

/* Scala titoli preservando dimensioni attuali */
h1 { 
  font-size: clamp(#{$h1-size-min}, 3vw, #{$h1-size-max});
  font-weight: 700; /* Più enfasi per il titolo principale */
}

h2 { 
  font-size: clamp(#{$h2-size-min}, 2.2vw, #{$h2-size-max}); 
  margin-top: calc(var(--space-xl) * 0.8); /* Leggermente meno spazio */
}

h3 { 
  font-size: clamp(#{$h3-size-min}, 1.6vw, #{$h3-size-max}); 
  margin-top: calc(var(--space-lg) * 0.9);
}

h4 { 
  font-size: #{$h4-size};
  margin-top: var(--space-lg);
  font-weight: 500; /* Meno enfasi per livelli inferiori */
}

h5 { 
  font-size: #{$h5-size};
  margin-top: var(--space-md);
  font-weight: 500;
}

h6 { 
  font-size: #{$h6-size};
  margin-top: var(--space-md);
  font-weight: 500;
  color: var(--bs-secondary-color); /* Tono più basso */
}

/* Nasconde numerazione da h2 in giù (mantiene solo capitoli) */
h2 .header-section-number,
h3 .header-section-number,
h4 .header-section-number,
h5 .header-section-number,
h6 .header-section-number {
  display: none;
}

/* Codice nei titoli in stile normale */
h1 code, h2 code, h3 code, h4 code, h5 code, h6 code {
  font-style: normal;
  font-variant-caps: normal;
  font-size: 0.9em; /* Leggermente più piccolo del titolo */
  background: var(--paper-cream);
  padding: 0.1em 0.3em;
  border-radius: 3px;
  border: 1px solid var(--border-light);
}

/* ===================================================================
   PARAGRAFI E TESTO CONTINUO
   =================================================================== */

p {
  margin: 0 0 var(--space-sm) 0;
  
  /* Rientro tipografico elegante */
  text-indent: 2em;
  
  /* Ottimizzazioni leggibilità */
  text-align: justify;
  text-justify: inter-word;
  hyphens: auto;
  -webkit-hyphens: auto;
  
  /* Feature tipografiche */
  font-variant-ligatures: common-ligatures;
  font-variant-numeric: oldstyle-nums proportional-nums;
  
  /* Controllo vedove/orfani */
  widows: 3;
  orphans: 3;
}

/* Rimuove rientro dopo elementi strutturali */
h1 + p, h2 + p, h3 + p, h4 + p, h5 + p, h6 + p,
.figure + p, figure + p, .table + p, table + p,
ul + p, ol + p, blockquote + p, pre + p, .callout + p,
div.sourceCode + p, .code-with-copy + p {
  text-indent: 0;
  margin-top: var(--space-sm);
}

/* Primo paragrafo di sezione senza rientro */
#quarto-content .content > p:first-of-type,
.quarto-title-block + * p:first-of-type,
section > p:first-of-type {
  text-indent: 0;
}

/* ===================================================================
   LINK E NAVIGAZIONE
   =================================================================== */

a {
  color: var(--bs-link-color);
  text-decoration: underline;
  text-decoration-thickness: 0.06em;
  text-underline-offset: 0.18em;
  text-decoration-skip-ink: auto;
  
  /* Transizione fluida */
  transition: all 0.2s ease-in-out;
}

a:hover {
  color: var(--bs-link-hover-color);
  text-decoration-thickness: 0.08em;
}

a:visited {
  opacity: 0.9;
}

/* Focus accessibile */
a:focus-visible {
  outline: 2px solid color-mix(in srgb, var(--accent-warm) 40%, transparent);
  outline-offset: 2px;
  border-radius: 3px;
}

/* Link esterni con icona discreta */
a .quarto-external-link {
  opacity: 0.55;
  margin-left: 0.1em;
  transition: opacity 0.2s ease;
}

a:hover .quarto-external-link {
  opacity: 0.8;
}

/* ===================================================================
   LISTE E ENUMERAZIONI
   =================================================================== */

ul, ol {
  margin-top: var(--space-xs);
  margin-bottom: var(--space-sm);
  padding-left: 2em;
}

li {
  margin-bottom: 0.3em;
  
  /* Stesso stile tipografico del corpo */
  font-variant-ligatures: common-ligatures;
  font-variant-numeric: oldstyle-nums proportional-nums;
  
  /* Liste giustificate */
  text-align: justify;
  hyphens: auto;
}

/* Liste annidate */
li > ul, li > ol {
  margin-top: 0.4em;
  margin-bottom: 0.4em;
}

/* ===================================================================
   CITAZIONI E BLOCKQUOTE
   =================================================================== */

blockquote {
  position: relative;
  margin: var(--space-lg) 2rem;
  padding: var(--space-xs) 0;
  border: none;
  
  /* Stile tipografico */
  font-style: italic;
  font-size: 1.02em;
  line-height: 1.6;
  color: color-mix(in srgb, var(--bs-body-color) 90%, black);
  
  /* Citazioni giustificate */
  text-align: justify;
  text-indent: 0; /* No rientro nelle citazioni */
}

/* Attribuzione citazione */
blockquote cite, 
blockquote .attribution {
  display: block;
  text-align: right;
  margin-top: var(--space-sm);
  font-variant-caps: small-caps;
  letter-spacing: 0.5px;
  font-style: normal;
  font-size: 0.9em;
  color: var(--bs-secondary-color);
}

/* ===================================================================
   TABELLE
   =================================================================== */

table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin: var(--space-lg) 0;
  font-size: 0.95rem;
  
  /* Bordo ornamentale */
  border: 2px solid color-mix(in srgb, var(--accent-warm) 30%, var(--border-warm));
  border-radius: 4px;
  
  /* Ombra sottile */
  box-shadow: 0 2px 4px var(--shadow-subtle);
}

th, td {
  padding: 0.6em 0.8em;
  text-align: left;
  vertical-align: top;
  border-bottom: 1px solid var(--border-light);
}

/* Header tabella */
thead th {
  background: color-mix(in srgb, var(--accent-warm) 15%, var(--paper-cream));
  color: var(--bs-body-color);
  font-weight: 600;
  font-variant-caps: small-caps;
  letter-spacing: 0.02em;
  
  /* Numeri lining per header */
  font-variant-numeric: lining-nums tabular-nums;
  font-feature-settings: "lnum" 1, "tnum" 1;
}

/* Righe alternate */
tbody tr:nth-child(even) td {
  background: color-mix(in srgb, var(--paper-warm) 70%, var(--paper-cream));
}

/* Celle dati con numeri tabulari */
td {
  font-variant-numeric: lining-nums tabular-nums;
  font-feature-settings: "lnum" 1, "tnum" 1;
}

/* Prima colonna con padding extra */
td:first-child, th:first-child {
  padding-left: 0.9rem;
}

/* ===================================================================
   CODICE E MONOSPACE
   =================================================================== */

code, kbd, samp {
  font-family: var(--bs-font-monospace);
  font-size: 0.84em;
  font-feature-settings: "calt" 1, "liga" 1;
  font-variant-ligatures: contextual common-ligatures;
}

/* Codice inline */
:not(pre) > code,
:not(pre) > kbd,
:not(pre) > samp {
  background-color: color-mix(in srgb, var(--paper-warm) 85%, var(--paper-cream));
  border: 1px solid color-mix(in srgb, var(--accent-warm) 20%, var(--border-light));
  border-radius: 2px;
  padding: 0.04em 0.2em;
  margin: 0 0.06em;
  vertical-align: baseline;
  
  /* Ombra interna per profondità */
  box-shadow: inset 0 0.5px 1px rgba(0,0,0,0.06);
  
  /* Reset feature numeric per codice */
  font-variant-numeric: normal;
  font-feature-settings: "lnum" 1, "tnum" 1;
}

/* Blocchi di codice */
pre {
  line-height: 1.5;
  margin: var(--space-lg) 0;
  font-size: 0.85em;
  overflow-x: auto;
  
  /* Reset tipografico */
  font-variant-numeric: normal;
  text-align: left;
  text-indent: 0;
  hyphens: none;
}

/* ===================================================================
   ELEMENTI MATEMATICI
   =================================================================== */

.math.inline {
  font-size: 1.04em;
  line-height: 1.5;
  vertical-align: baseline;
  
  /* Reset tipografico */
  text-align: start;
  text-indent: 0 !important;
  hyphens: none;
}

.math.display {
  font-size: 1.08em;
  line-height: 1.5;
  margin: var(--space-lg) 0;
  text-align: center;
  text-indent: 0 !important;
}

/* MathJax specifico */
mjx-container {
  font-size: 104%;
  line-height: 1.5;
  font-family: var(--bs-font-serif) !important;
  color: inherit;
  
  /* Reset per evitare interferenze */
  font-variant-numeric: normal;
  font-variant-caps: normal;
  letter-spacing: normal;
  text-indent: 0 !important;
  hyphens: none;
}

mjx-container[display="true"] {
  margin: var(--space-lg) 0;
  padding: var(--space-xs) 0;
  position: relative;
}

/* Effetto hover sottile per formule importanti */
mjx-container[display="true"]:hover {
  background: color-mix(in srgb, var(--accent-warm) 3%, transparent);
  border-radius: 3px;
  transition: background 0.3s ease;
}

/* ===================================================================
   FIGURE E IMMAGINI
   =================================================================== */

figure, .figure {
  margin: var(--space-lg) auto;
  text-align: center;
}

figure img, .figure img {
  max-width: 100%;
  height: auto;
  border: 1px solid var(--border-light);
  border-radius: 3px;
  box-shadow: 0 2px 8px var(--shadow-subtle);
}

.figure-caption, figcaption, caption {
  font-size: 0.92em;
  font-style: italic;
  text-align: center;
  margin-top: 0.5rem;
  color: var(--bs-secondary-color);
  line-height: 1.4;
  
  /* Feature tipografiche per didascalie */
  font-variant-numeric: oldstyle-nums proportional-nums;
  font-feature-settings: "liga" 1, "onum" 1, "pnum" 1;
}

/* ===================================================================
   NOTE E RIFERIMENTI
   =================================================================== */

.footnotes {
  margin-top: calc(var(--space-xl) * 1.5);
  padding-top: var(--space-lg);
  border-top: none; /* Rimosso bordo standard */
  font-size: 0.9em;
  line-height: 1.5;
}

/* Separatore ornamentale per note */
.footnotes::before {
  content: "";
  display: block;
  width: 6rem;
  height: 1px;
  background: var(--border-warm);
  margin: 0 0 var(--space-lg) 0;
}

.footnotes ol {
  padding-left: 1.5em;
}

.footnotes ol li {
  text-indent: -1em;
  margin-left: 1em;
  margin-bottom: var(--space-xs);
}

/* Riferimenti note */
.footnote-ref {
  font-size: 0.75em;
  text-decoration: none;
  color: var(--bs-secondary-color);
  font-variant-position: super;
  font-variant-numeric: lining-nums;
}

.footnote-ref::before { content: "["; }
.footnote-ref::after { content: "]"; }

.footnote-ref:hover {
  color: var(--accent-warm);
  text-decoration: underline;
}

/* ===================================================================
   ELEMENTI DECORATIVI
   =================================================================== */

/* Regola orizzontale ornamentale */
hr {
  border: 0;
  height: 0;
  text-align: center;
  margin: calc(var(--space-xl) * 1.2) 0;
}

hr::before {
  content: "* * *";
  color: color-mix(in srgb, var(--accent-warm) 50%, transparent);
  font-size: 1.2em;
  letter-spacing: 1em;
  margin-left: 1em;
}

/* Ornamenti per separazioni */
.ornament, .vignette {
  text-align: center;
  font-size: 1.5em;
  margin: calc(var(--space-xl) * 1.2) 0;
  color: color-mix(in srgb, var(--accent-warm) 60%, transparent);
}

.ornament::before { content: "❦"; }
.vignette.fleuron::before { content: "⧫ ❦ ⧫"; letter-spacing: 0.8em; margin-left: 0.8em; }

/* ===================================================================
   RESPONSIVE DESIGN
   =================================================================== */

/* Tablet */
@media (max-width: 768px) {
  :root {
    font-size: 17px; /* Base leggermente ridotta */
  }
  
  /* Margini ridotti per blockquote */
  blockquote {
    margin: var(--space-md) 1rem;
  }
  
  blockquote::before, blockquote::after {
    font-size: 2.8em;
  }
  
  /* Tabelle scrollabili */
  table {
    font-size: 0.9rem;
  }
}

/* Mobile */
@media (max-width: 480px) {
  :root {
    font-size: 16px;
  }
  
  /* Rientro ridotto su mobile */
  p {
    text-indent: 1.5em;
  }
  
  /* Virgolette blockquote più piccole */
  blockquote::before, blockquote::after {
    font-size: 2.2em;
  }
  
  blockquote {
    margin: var(--space-md) 0.5rem;
  }
  
  /* Codice inline più piccolo */
  :not(pre) > code {
    font-size: 0.82em;
    padding: 0.03em 0.16em;
  }
}

/* Print */
@media print {
  :root {
    font-size: 11pt;
    --space-lg: 14pt;
    --space-xl: 18pt;
  }
  
  body {
    line-height: 1.5;
    color: black;
    background: white;
  }
  
  /* Nasconde elementi non necessari */
  nav, .sidebar, header, footer {
    display: none !important;
  }
  
  /* Link senza decorazioni */
  a {
    color: black;
    text-decoration: none;
  }
  
  /* Controllo interruzioni pagina */
  h1, h2, h3 {
    page-break-after: avoid;
    break-after: avoid-page;
  }
  
  figure, table, .callout {
    page-break-inside: avoid;
    break-inside: avoid;
  }
  
  /* Bordi e ombre più leggeri per stampa */
  table, figure img {
    border-color: #666;
    box-shadow: none;
  }
}

/* ===================================================================
   UTILITY CLASSES
   =================================================================== */

/* Tipografia */
.sc, .small-caps { 
  font-variant-caps: small-caps; 
  letter-spacing: 0.04em; 
}

.oldstyle-nums { 
  font-variant-numeric: oldstyle-nums proportional-nums; 
}

.lining-nums { 
  font-variant-numeric: lining-nums tabular-nums; 
}

/* Allineamenti */
.text-center { text-align: center; }
.text-right { text-align: right; }
.no-indent { text-indent: 0 !important; }
.no-justify { text-align: left !important; }

/* Spaziature */
.space-above { margin-top: var(--space-lg); }
.space-below { margin-bottom: var(--space-lg); }
.double-space { margin: var(--space-xl) 0; }

/* Enfasi discrete */
.subtle-emphasis {
  font-style: italic;
  font-weight: 450;
  color: color-mix(in srgb, var(--bs-body-color) 90%, black);
}

.muted-text {
  color: var(--bs-muted-color);
  font-size: 0.9em;
}


/* ===================================================================
   CAPOLETTERA DECORATA
   =================================================================== */

/* === Garamontio Capo (capolettera) === */
@font-face {
  font-family: "Garamontio Capo";
  src: url("./style/garamontio-capo/GaramontioCapo-Regular.woff2") format("woff2");
  font-style: normal;
  font-weight: 400;
  font-display: swap;
}

/* Colori di default (puoi sovrascriverli a livello tema/pagina) */
:root {
  /* colore della LETTERA (sopra) */
  --capo-fg: currentColor;
  /* colore dello SFONDO (sotto), leggermente schiarito rispetto al testo */
  --capo-bg: color-mix(in oklch, currentColor 25%, white);
}

/* Variante scura (se usi dark mode) */
:root.dark, .quarto-dark {
  --capo-fg: currentColor;
  --capo-bg: color-mix(in oklch, currentColor 25%, black);
}

/* Paragrafo con capolettera decorato (sfondo + lettera) */
p.capo {
  position: relative;
}

/* Layer SFONDO (la cifra 0–9) sotto la lettera */
.capo-initial::before {
  content: attr(data-bg);           /* 0–9 seleziona il disegno di sfondo */
  position: absolute;
  inset: 0;
  z-index: 0;                       /* sotto la lettera */
  font-family: "Garamontio Capo", serif;
  font-feature-settings: "ss01" 1;  /* stessa centratura */
  color: var(--capo-bg);            /* colore SFONDO */
  opacity: 0.90;                    /* tenue ma presente */
  pointer-events: none;

  /* opzionale: integrazione cromatica più “stampata” */
  mix-blend-mode: multiply; 
}

/* Blocco iniziale: LETTERA sopra */
.capo-initial {
  position: relative;        /* crea stacking context */
  isolation: isolate;        /* isola i layer interni */
  float: left;
  display: inline-block;
  font-family: "Garamontio Capo", serif;
  line-height: 0.85;
  font-size: 4.8rem;
  margin: 0.12rem 0.6rem 0 0.06rem;
  font-feature-settings: "ss01" 1;
  color: var(--capo-fg);
  z-index: 1;                /* la lettera è sopra lo sfondo */
}

/* Layer SFONDO (sotto alla lettera) */
.capo-initial::before {
  content: attr(data-bg);
  position: absolute;
  inset: 0;
  font-family: "Garamontio Capo", serif;
  font-feature-settings: "ss01" 1;
  color: var(--capo-bg);
  opacity: 0.90;
  pointer-events: none;
  z-index: -1;               /* sfondo sotto */
}


/* ===================================================================
   BLOCCHI DI CODICE — STILE UMANISTICO PULITO (Quarto)
   - Base compatta e leggibile
   - Varianti semantiche leggere
   - Integrazione tipografica con il testo e i callout
   - Responsive ed accessibilità
   =================================================================== */

/* -----------------------------
   0) Parametri di spaziatura
   ----------------------------- */
:root {
  /* Fallback se non definiti altrove */
  --paper-warm: #fdfcf8;
  --accent-warm: #8B4513;
  --text-primary: #2d2926;
  --text-secondary: #5d5349;

  --space-xs: 0.382rem;
  --space-sm: 0.618rem;
  --space-md: 1.000rem;
  --space-lg: 1.618rem;

  --para-gap: 0.70rem;      /* spazio tra paragrafi */
  --code-gap: 0.90rem;      /* spazio tra testo e blocco codice */
  --code-gap-tight: 0.40rem;/* spazio tra blocchi adiacenti di solo codice */
}

/* ---------------------------------------------------
   1) BASE — tutti i blocchi di codice Quarto/Pandoc
   --------------------------------------------------- */
div.sourceCode > pre,
pre.sourceCode,
.code-with-copy pre,
pre[class*="sourceCode"] {
  margin: var(--space-sm) 0 var(--space-md) !important;
  padding: var(--space-xs) var(--space-sm) var(--space-xs) calc(var(--space-sm) - 2px) !important;

  /* sfondo leggerissimo, armonizzato con la “carta” */
  background: linear-gradient(
    135deg,
    color-mix(in srgb, var(--paper-warm) 98%, #f0ead6) 0%,
    color-mix(in srgb, var(--paper-warm) 99%, #e8dcc0) 100%
  ) !important;

  border: none !important;
  border-left: 2px solid color-mix(in srgb, var(--accent-warm) 35%, transparent) !important;
  border-radius: 0 2px 2px 0;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.2),
    0 1px 2px rgba(0,0,0,0.03);

  font-size: 0.85em;
  line-height: 1.55; /* coerente con il testo */
  position: relative; /* per eventuali decorazioni */
}

/* codice inline (armonizzato) */
:not(pre) > code,
:not(pre) > kbd,
:not(pre) > samp {
  background-color: color-mix(in srgb, var(--paper-warm) 85%, #f0ead6) !important;
  border: 1px solid color-mix(in srgb, var(--accent-warm) 20%, #e6e2d9) !important;
  border-radius: 2px;
  padding: 0.04em 0.20em !important;
  font-size: 0.84em !important;
  box-shadow: inset 0 0.5px 1px rgba(0,0,0,0.06);
  margin: 0 0.06em;
  vertical-align: baseline;
}

/* ---------------------------------------------------
   2) VARIANTI SEMANTICHE (opzionali via classi)
   --------------------------------------------------- */

/* blocco principale / in evidenza */
.code-primary div.sourceCode > pre {
  border-left: 3px solid var(--text-primary) !important;
  font-weight: 500;
}

/* blocchi di supporto / esempi compatti */
.code-secondary div.sourceCode > pre,
.code-example   div.sourceCode > pre {
  margin: 0.5rem 0 !important;
  padding: 0.5rem 0.7rem !important;
  border-left: 2px solid color-mix(in srgb, currentColor 20%, transparent) !important;
  opacity: 0.92;
  font-size: 0.84em;
}

/* blocco molto integrato nel testo */
.code-inline div.sourceCode > pre {
  display: inline-block;
  margin: 0.2em 0.4em !important;
  padding: 0.25em 0.5em !important;
  border-left: none !important;
  border: 1px solid #e6e2d9 !important;
  border-radius: 3px;
  background: color-mix(in srgb, var(--paper-warm) 92%, #f8f6f0) !important;
  font-size: 0.82em;
  line-height: 1.3;
  vertical-align: baseline;
}

/* “marginalia” per note di codice brevi */
.code-marginalia div.sourceCode > pre {
  margin: 0.4rem 0 !important;
  padding: 0.4rem 0.6rem !important;
  background: color-mix(in srgb, var(--paper-warm) 90%, #f0f0f0) !important;
  border: none !important;
  border-left: 1px solid color-mix(in srgb, currentColor 15%, transparent) !important;
  font-size: 0.82em;
  line-height: 1.4;
  font-style: italic;
}

/* variante “manoscritto” più decorativa */
.manuscript-style div.sourceCode > pre {
  position: relative;
  background: color-mix(in srgb, #f4f1e8 80%, white) !important;
  border: 1px solid #d4c4a0 !important;
  border-radius: 0 !important;
  margin: 0.7rem 0 !important;
  padding: 0.8rem !important;
  box-shadow: inset 0 0 8px rgba(0,0,0,0.03);
  font-family: "Fira Code", "SF Mono", monospace;
  font-size: 0.86em;
  line-height: 1.5;
}
.manuscript-style div.sourceCode > pre::before {
  content: "";
  position: absolute;
  top: -1px; left: -1px;
  width: 12px; height: 12px;
  background: linear-gradient(135deg, #d4c4a0 50%, transparent 50%);
  pointer-events: none;
}

/* -----------------------------------------------
   3) CONTESTO TIPOGRAFICO (spaziature coerenti)
   ----------------------------------------------- */

/* paragrafi: gap base */
p { margin: 0 0 var(--para-gap) 0; }

/* gap sopra un blocco codice quando preceduto da testo/lista/etc. */
:is(p, ul, ol, blockquote, .callout, table, figure, .figure)
  + :is(div.sourceCode, pre.sourceCode, .code-with-copy) {
  margin-top: var(--code-gap) !important;
}

/* gap sotto un blocco codice quando seguito da testo/lista/etc. */
:is(div.sourceCode, pre.sourceCode, .code-with-copy)
  + :is(p, ul, ol, blockquote, .callout, table, figure, .figure) {
  margin-top: var(--code-gap) !important;
}

/* niente indentazione del primo paragrafo dopo il codice */
:is(div.sourceCode, pre.sourceCode, .code-with-copy) + p {
  text-indent: 0 !important;
}

/* sequenze di blocchi codice: gap più stretto */
:is(div.sourceCode, pre.sourceCode, .code-with-copy)
  + :is(div.sourceCode, pre.sourceCode, .code-with-copy) {
  margin-top: var(--code-gap-tight) !important;
}

/* primo blocco dopo un titolo: gap misurato */
h1 + :is(div.sourceCode, pre.sourceCode, .code-with-copy),
h2 + :is(div.sourceCode, pre.sourceCode, .code-with-copy),
h3 + :is(div.sourceCode, pre.sourceCode, .code-with-copy),
h4 + :is(div.sourceCode, pre.sourceCode, .code-with-copy) {
  margin-top: var(--para-gap) !important;
}

/* ---------------------------------------------------
   4) CONTESTO SPECIFICO (blockquote / callout)
   --------------------------------------------------- */

blockquote div.sourceCode > pre,
blockquote pre.sourceCode {
  margin: var(--space-xs) 0 !important;
  padding: var(--space-xs) var(--space-sm) !important;
  background: transparent !important;
  border-left: 1px solid color-mix(in srgb, currentColor 25%, transparent) !important;
  font-style: inherit; /* eredita l’italic del blockquote */
  opacity: 0.9;
  box-shadow: none;
}

.callout div.sourceCode > pre,
.callout pre.sourceCode {
  margin: calc(var(--space-xs) * 0.8) 0 !important;
  padding: calc(var(--space-xs) * 0.8) var(--space-sm) !important;
  background: color-mix(in srgb, var(--paper-warm) 94%, transparent) !important;
  border-left-width: 1.5px !important;
  font-size: 0.86em;
}

/* ---------------------------------------------------
   5) LINGUAGGI — leggere variazioni cromatiche
   --------------------------------------------------- */

div.sourceCode[class*="r"] > pre,
div.sourceCode[class*="R"] > pre,
pre.sourceCode.r,
pre.sourceCode.R {
  border-left-color: color-mix(in srgb, #1f77b4 50%, var(--accent-warm)) !important;
  background: linear-gradient(
    135deg,
    color-mix(in srgb, var(--paper-warm) 97%, #e8f0ff) 0%,
    color-mix(in srgb, var(--paper-warm) 99%, #f0f8ff) 100%
  ) !important;
}

div.sourceCode[class*="python"] > pre,
pre.sourceCode.python {
  border-left-color: color-mix(in srgb, #2e8b57 50%, var(--accent-warm)) !important;
  background: linear-gradient(
    135deg,
    color-mix(in srgb, var(--paper-warm) 97%, #e8f5e8) 0%,
    color-mix(in srgb, var(--paper-warm) 99%, #f0f8f0) 100%
  ) !important;
}

div.sourceCode[class*="sql"] > pre,
pre.sourceCode.sql {
  border-left-color: color-mix(in srgb, #8b4513 60%, var(--accent-warm)) !important;
  background: linear-gradient(
    135deg,
    color-mix(in srgb, var(--paper-warm) 97%, #f5f0e8) 0%,
    color-mix(in srgb, var(--paper-warm) 99%, #f8f5f0) 100%
  ) !important;
}

/* ---------------------------------------------------
   6) SYNTAX HIGHLIGHTING — micro-tuning
   --------------------------------------------------- */

.sourceCode .kw,  /* keywords */
.sourceCode .cf { /* control flow */
  font-feature-settings: "smcp" 1 !important; /* small caps */
  font-weight: 500 !important;
  color: var(--accent-warm) !important;
  letter-spacing: 0.3px;
}

.sourceCode .st,
.sourceCode .vs { /* stringhe */
  color: color-mix(in srgb, var(--accent-warm) 80%, #654321) !important;
  font-style: italic;
}

/* eccezione: nei blocchi R le stringhe restano non-italic per leggibilità */
pre.sourceCode.r .st,
pre.sourceCode.R .st { font-style: normal !important; }

.sourceCode .co,
.sourceCode .do { /* commenti */
  color: var(--text-secondary) !important;
  font-style: italic !important;
  font-feature-settings: "liga" 1, "onum" 1, "pnum" 1 !important;
  opacity: 0.85;
}

.sourceCode .dv,
.sourceCode .bn,
.sourceCode .fl { /* numeri */
  font-feature-settings: "onum" 1, "pnum" 1 !important;
  color: color-mix(in srgb, var(--text-primary) 90%, var(--accent-warm)) !important;
}

/* ---------------------------------------------------
   7) ACCESSIBILITÀ E FOCUS
   --------------------------------------------------- */
div.sourceCode > pre:focus-within,
pre.sourceCode:focus-within {
  outline: 2px solid color-mix(in srgb, var(--accent-warm) 40%, transparent);
  outline-offset: 2px;
  border-radius: 2px;
}

/* ---------------------------------------------------
   8) RESPONSIVE
   --------------------------------------------------- */
@media (max-width: 768px) {
  div.sourceCode > pre,
  pre.sourceCode,
  .code-with-copy pre {
    margin: calc(var(--space-xs) * 0.8) 0 !important;
    padding: calc(var(--space-xs) * 0.8) calc(var(--space-sm) * 0.8) !important;
    font-size: 0.84em;
  }
  /* nasconde eventuali decorazioni */
  div.sourceCode > pre::after,
  pre.sourceCode::after { display: none; }
}

@media (max-width: 480px) {
  :not(pre) > code { /* inline code più compatto */
    font-size: 0.82em !important;
    padding: 0.03em 0.16em !important;
  }
  div.sourceCode > pre,
  pre.sourceCode {
    margin: 0.4rem 0 !important;
    padding: 0.5rem 0.6rem !important;
  }
}

/* ---------------------------------------------------
   9) UTILITY CLASSES (uso pratico da .qmd)
   --------------------------------------------------- */
/* {.code-compact} */
.code-compact div.sourceCode > pre {
  margin: 0.4rem 0 !important;
  padding: 0.4rem 0.6rem !important;
}

/* {.code-breathe} */
.code-breathe div.sourceCode > pre {
  margin: 1.2rem 0 !important;
  padding: 1rem !important;
}

/* {.code-sequence} per serie di blocchi ravvicinati */
.code-sequence div.sourceCode > pre { margin: 0.3rem 0 !important; }
.code-sequence div.sourceCode:not(:last-child) > pre {
  margin-bottom: 0.2rem !important;
  border-bottom: 1px dotted #e0e0e0;
}

/* ---------------------------------------------------
   10) (OPZIONALE) Numerazione blocchi consecutivi
   --------------------------------------------------- */
.content { counter-reset: code-sequence; }
div.sourceCode + div.sourceCode > pre::before,
pre.sourceCode + div.sourceCode > pre::before {
  counter-increment: code-sequence;
  content: counter(code-sequence);
  position: absolute;
  top: 0.3rem; right: 0.4rem;
  width: 1rem; height: 1rem;
  background: color-mix(in srgb, var(--accent-warm) 20%, transparent);
  color: var(--accent-warm);
  border-radius: 50%;
  font-size: 0.65rem; font-weight: 600;
  display: flex; align-items: center; justify-content: center;
  opacity: 0.7;
}


/* ===================================================================
   UTILITA' DROP CAP OPT-IN PER LA PAGINA INIZIALE
   =================================================================== */

.dropcap-sm::first-letter {
  font-size: clamp(1.4rem, 3vw, 2.0rem);
  line-height: 1;              /* allinea meglio col testo */
  float: left;
  margin: 0.05em 0.14em 0 0;
  vertical-align: top;         /* evita di spingere verso il basso */
  font-family: var(--bs-font-serif, "Palatino nova Pro", Palatino, "Times New Roman", serif);
  font-weight: 400;
  color: var(--text-primary, #2d2926);
}

/* Varianti pronte: più piccolo / più grande */
.dropcap-sm::first-letter { font-size: clamp(1.4rem, 3vw, 2.0rem); }
.dropcap-lg::first-letter { font-size: clamp(1.9rem, 4.2vw, 2.8rem); }

/* Utility per disattivare il drop cap */
.no-dropcap::first-letter {
  float: none;
  font-size: inherit;
  margin: 0;
}

/* =======================================================
   CTA buttons per link con classe .cta
   - Stile base "outline" con hover pieno
   - Varianti .cta-solid (pieno), .cta-ghost (minimo)
   - Stati :hover / :active / :focus-visible accessibili
   - Supporto dark-mode e riduzione motion
   ======================================================= */

/* Palette derivata (fallback ai tuoi custom properties) */
:root {
  --cta-accent: var(--accent-warm, #8B4513);
  --cta-bg:     var(--paper-warm, #fdfcf8);
  --cta-text:   var(--text-primary, #2d2926);
}

/* Layout rapido per righe di CTA (opzionale) */
.cta-row {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem 0.6rem;
  align-items: center;
}

/* Base: link a forma di bottone */
a.cta, .cta {
  --_border: color-mix(in srgb, var(--cta-accent) 65%, transparent);
  --_hover-bg: color-mix(in srgb, var(--cta-accent) 14%, var(--cta-bg));
  --_active-bg: color-mix(in srgb, var(--cta-accent) 22%, var(--cta-bg));

  display: inline-flex;
  align-items: center;
  gap: 0.45em;

  padding: 0.45rem 0.85rem;
  border: 1px solid var(--_border);
  border-radius: 10px; /* morbido, stile “umanistico” */
  background: transparent;
  color: var(--cta-text);
  text-decoration: none;
  line-height: 1.2;

  box-shadow: 0 1px 0 rgba(0,0,0,0.04);
  transition: background-color .18s ease, color .18s ease, border-color .18s ease, box-shadow .18s ease, transform .04s ease;
}

/* Hover/active */
a.cta:hover, .cta:hover {
  background: var(--_hover-bg);
  border-color: color-mix(in srgb, var(--cta-accent) 80%, transparent);
  color: var(--cta-text);
}
a.cta:active, .cta:active {
  background: var(--_active-bg);
  transform: translateY(1px);
}

/* Focus visibile (accessibilità) */
a.cta:focus-visible, .cta:focus-visible {
  outline: 2px solid color-mix(in srgb, var(--cta-accent) 55%, transparent);
  outline-offset: 2px;
  box-shadow:
    0 0 0 2px color-mix(in srgb, var(--cta-bg) 85%, transparent),
    0 0 0 4px color-mix(in srgb, var(--cta-accent) 35%, transparent);
}

/* Variante piena */
a.cta.cta-solid, .cta.cta-solid {
  background: color-mix(in srgb, var(--cta-accent) 16%, var(--cta-bg));
  border-color: color-mix(in srgb, var(--cta-accent) 80%, transparent);
}
a.cta.cta-solid:hover, .cta.cta-solid:hover {
  background: color-mix(in srgb, var(--cta-accent) 22%, var(--cta-bg));
}

/* Variante ultra-minima */
a.cta.cta-ghost, .cta.cta-ghost {
  border-color: color-mix(in srgb, var(--cta-accent) 35%, transparent);
  background: transparent;
}
a.cta.cta-ghost:hover, .cta.cta-ghost:hover {
  background: color-mix(in srgb, var(--cta-accent) 10%, var(--cta-bg));
}

/* Dimensioni pronte */
a.cta.cta-sm, .cta.cta-sm { padding: 0.35rem 0.65rem; border-radius: 8px; font-size: 0.95em; }
a.cta.cta-lg, .cta.cta-lg { padding: 0.60rem 1.00rem; border-radius: 12px; font-size: 1.05em; }

/* Stato disabilitato (se mai serve) */
a.cta[aria-disabled="true"], .cta[aria-disabled="true"] {
  opacity: .55; pointer-events: none;
}

/* Dark mode: aumenta contrasto */
@media (prefers-color-scheme: dark) {
  a.cta, .cta {
    --_border: color-mix(in srgb, var(--cta-accent) 70%, transparent);
    --_hover-bg: color-mix(in srgb, var(--cta-accent) 24%, #111);
    --_active-bg: color-mix(in srgb, var(--cta-accent) 30%, #111);
    color: color-mix(in srgb, white 92%, var(--cta-text));
    box-shadow: none;
  }
}

/* Riduci animazioni se richiesto dall’utente */
@media (prefers-reduced-motion: reduce) {
  a.cta, .cta { transition: none; }
}


/* =======================================================
  Footnote refs: allineamento pulito
   ======================================================= */

.content sup {             /* reset del sup nel contenuto */
  vertical-align: baseline;
  position: static;
  line-height: 0;          /* evita che il sup allarghi la riga */
}

.content a[role="doc-noteref"],
.content sup > a.footnote-ref {
  position: relative;
  top: -0.33em;            /* regola fine: prova tra -0.28 e -0.38 */
  font-size: 0.75em;
  text-decoration: none;
  font-variant-numeric: lining-nums; /* evita problemi con oldstyle-nums */
}

/* Rimuovi eventuali parentesi aggiunte dal tema */
.content a[role="doc-noteref"]::before,
.content a[role="doc-noteref"]::after,
.content sup > a.footnote-ref::before,
.content sup > a.footnote-ref::after { content: none; }

















/* =====================================================
   ENHANCED HUMANISTIC TYPOGRAPHY SYSTEM
   Building on existing foundation with classical refinements
   ===================================================== */

/* ===================================================================
   ENHANCED TYPOGRAPHIC FOUNDATION
   =================================================================== */

/* Refined font hierarchy with better classical proportions */
:root {
  /* Enhanced serif stack prioritizing humanistic characteristics */
  --font-serif-humanistic: "EB Garamond", "Adobe Garamond Pro", "Sabon", 
                           "Palatino Linotype", "Palatino", "Minion Pro",
                           "Crimson Text", Georgia, "Times New Roman", serif;
  
  /* Classical proportions based on the golden ratio and musical intervals */
  --scale-base: 0.9rem;        /* Reduced from 1rem */
  --scale-minor-third: 1.2;    /* 6:5 ratio */
  --scale-major-third: 1.25;   /* 5:4 ratio */
  --scale-perfect-fourth: 1.333; /* 4:3 ratio */
  --scale-golden: 1.618;       /* φ */
  
  /* Refined spacing using Tschichold's proportions */
  --space-hair: 0.125rem;      /* 1/8 */
  --space-thin: 0.25rem;       /* 1/4 */
  --space-base: 1rem;
  --space-golden: 1.618rem;    /* φ */
  --space-double-golden: 2.618rem; /* φ² */
  
  /* Enhanced color palette with classical manuscript influences */
  --ink-primary: #1a1611;      /* Deep warm black */
  --ink-secondary: #3d342a;    /* Warm dark brown */
  --ink-tertiary: #6b5b4a;     /* Medium brown */
  --parchment: #fdfcf8;        /* Matches figure/code background exactly */
  --vellum: #f8f6f0;           /* Cream - matches code background */
  --rubric-red: #a0522d;       /* Sienna for emphasis */
  --illumination-blue: #4a5568; /* Muted blue for accents */
}

/* Body text optimization for long-form reading */
body {
  font-family: var(--font-serif-humanistic);
  color: var(--ink-primary);
  background-color: var(--parchment);
  
  /* Classical proportions - scaled down proportionally */
  font-size: clamp(16px, 1rem, 19px);    /* Reduced from 18-22px */
  line-height: 1.618; /* Golden ratio */
  
  /* Advanced typography features */
  font-variant-ligatures: common-ligatures discretionary-ligatures historical-ligatures;
  font-variant-numeric: oldstyle-nums proportional-nums;
  font-feature-settings: "liga" 1, "dlig" 1, "hlig" 1, "onum" 1, "pnum" 1, "kern" 1;
  
  /* Optimized rendering */
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ===================================================================
   REFINED HEADING HIERARCHY
   =================================================================== */

h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-serif-humanistic);
  color: var(--ink-primary);
  font-weight: 500; /* Lighter weight for classical elegance */
  
  /* Classical small caps for all headings */
  font-variant-caps: small-caps;
  letter-spacing: 0.05em;
  
  /* Advanced features */
  font-variant-ligatures: common-ligatures discretionary-ligatures;
  font-feature-settings: "liga" 1, "dlig" 1, "smcp" 1, "c2sc" 1;
  
  /* Harmonious spacing */
  margin-top: var(--space-double-golden);
  margin-bottom: var(--space-golden);
  line-height: 1.2;
  
  /* Prevent awkward breaks */
  text-wrap: balance;
  hanging-punctuation: first last;
}

/* Refined size scale using classical proportions */
h1 { 
  font-size: calc(var(--scale-base) * var(--scale-golden) * var(--scale-golden)); /* φ² */
  margin-top: calc(var(--space-double-golden) * 1.5);
}

h2 { 
  font-size: calc(var(--scale-base) * var(--scale-golden) * var(--scale-major-third)); 
  color: var(--rubric-red); /* Classical rubric treatment */
}

h3 { 
  font-size: calc(var(--scale-base) * var(--scale-golden));
}

h4 { 
  font-size: calc(var(--scale-base) * var(--scale-perfect-fourth));
}

h5, h6 { 
  font-size: calc(var(--scale-base) * var(--scale-minor-third));
  color: var(--ink-secondary);
}

/* Enhanced drop capital system */
.initial-cap::first-letter,
.dropcap::first-letter {
  float: left;
  font-family: var(--font-serif-humanistic);
  font-size: 5.5rem;
  line-height: 0.8;
  margin: 0.05em 0.1em 0 0;
  padding: 0.02em;
  
  /* Classical decoration */
  color: var(--rubric-red);
  font-weight: 400;
  font-variant-caps: normal;
  
  /* Subtle ornamental effect */
  text-shadow: 0 0 0 var(--ink-primary);
  position: relative;
}

/* Optional decorative initial background */
.initial-cap.decorated::first-letter::before {
  content: attr(data-decoration);
  position: absolute;
  inset: 0;
  color: var(--illumination-blue);
  opacity: 0.2;
  font-size: 1.1em;
  z-index: -1;
}

/* ===================================================================
   ENHANCED PARAGRAPH STYLING
   =================================================================== */

p {
  margin: 0;
  text-indent: var(--space-golden);
  
  /* Classical justification */
  text-align: justify;
  text-justify: inter-word;
  hyphens: auto;
  hyphenate-limit-chars: 6 3 2;
  
  /* Advanced typography */
  hanging-punctuation: first last;
  text-wrap: pretty;
  
  /* Prevent orphans and widows */
  orphans: 3;
  widows: 3;
}

/* Remove indentation after structural elements */
h1 + p, h2 + p, h3 + p, h4 + p, h5 + p, h6 + p,
blockquote + p, figure + p, table + p, .callout + p,
div.sourceCode + p, pre + p, ul + p, ol + p {
  text-indent: 0;
  margin-top: var(--space-base);
}

/* First paragraph of sections */
.content > p:first-of-type,
section > p:first-of-type {
  text-indent: 0;
}

/* ===================================================================
   CLASSICAL QUOTATIONS
   =================================================================== */

blockquote {
  position: relative;
  margin: var(--space-double-golden) var(--space-golden);
  padding: var(--space-base) 0;
  border: none;
  
  font-style: italic;
  font-size: 1.05em;
  line-height: 1.6;
  color: var(--ink-secondary);
  text-align: justify;
  text-indent: 0;
}

/* Enhanced quotation marks */
blockquote::before,
blockquote::after {
  font-family: var(--font-serif-humanistic);
  font-size: 4rem;
  line-height: 1;
  color: var(--illumination-blue);
  opacity: 0.3;
  position: absolute;
}

/*
blockquote::before {
  content: """;
  left: -2.5rem;
  top: -0.8rem;
}

blockquote::after {
  content: """;
  right: -2rem;
  bottom: -1.5rem;
}
*/

/* Citation styling */
blockquote cite,
blockquote .attribution {
  display: block;
  text-align: right;
  margin-top: var(--space-base);
  font-style: normal;
  font-variant-caps: small-caps;
  letter-spacing: 0.05em;
  color: var(--ink-tertiary);
}

/* ===================================================================
   CLASSICAL ORNAMENTS AND DECORATIONS
   =================================================================== */

/* Enhanced ornamental breaks */
.ornament,
.vignette {
  display: block;
  text-align: center;
  margin: var(--space-double-golden) 0;
  font-size: 1.5em;
  color: var(--illumination-blue);
  opacity: 0.7;
}

.ornament::before {
  content: "❦"; /* fleuron */
}

.ornament.asterisk::before {
  content: "∗ ∗ ∗";
  letter-spacing: 1em;
  margin-left: 1em;
}

.ornament.fleuron::before {
  content: "❦ ◊ ❦";
  letter-spacing: 0.5em;
  margin-left: 0.5em;
}

/* Section dividers */
hr {
  border: 0;
  height: 0;
  text-align: center;
  margin: var(--space-double-golden) 0;
}

hr::before {
  content: "§ § §";
  color: var(--illumination-blue);
  opacity: 0.6;
  font-size: 1.2em;
  letter-spacing: 1em;
  margin-left: 1em;
}

/* Finials for chapter endings */
.finial {
  text-align: center;
  margin: calc(var(--space-double-golden) * 1.5) 0;
  font-size: 1.8em;
  color: var(--rubric-red);
  opacity: 0.8;
}

.finial::before {
  content: "❦";
  /* Alternative: content: "✾"; */
}

/* ===================================================================
   ENHANCED LINKS
   =================================================================== */

a {
  color: var(--ink-secondary);
  text-decoration: underline;
  text-decoration-thickness: 0.05em;
  text-underline-offset: 0.15em;
  text-decoration-skip-ink: auto;
  
  transition: all 0.2s ease-in-out;
}

a:hover {
  color: var(--rubric-red);
  text-decoration-thickness: 0.08em;
}

a:visited {
  color: var(--ink-tertiary);
  opacity: 0.9;
}

/* ===================================================================
   REFINED LISTS
   =================================================================== */

ul, ol {
  margin: var(--space-base) 0;
  padding-left: var(--space-double-golden);
}

li {
  margin-bottom: 0.5em;
  text-align: justify;
  hyphens: auto;
}

/* Classical list markers */
ul > li::marker {
  content: "• ";
  color: var(--illumination-blue);
}

/* Nested lists with varied markers */
ul ul > li::marker { content: "◦ "; }
ul ul ul > li::marker { content: "▪ "; }

/* ===================================================================
   ENHANCED TABLES
   =================================================================== */

table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin: var(--space-double-golden) 0;
  
  /* Classical frame with better contrast */
  border: 2px solid var(--ink-secondary);
  border-radius: 0; /* Classical tables are rectangular */
  
  font-variant-numeric: lining-nums tabular-nums;
  font-feature-settings: "lnum" 1, "tnum" 1;
  
  /* Ensure good contrast */
  background: var(--parchment);
}

th, td {
  padding: 0.75em 1em;
  text-align: left;
  vertical-align: top;
  border-bottom: 1px solid var(--ink-tertiary);
  /* Removed opacity that was causing readability issues */
}

thead th {
  background: var(--ink-secondary);  /* Strong contrast background */
  color: var(--parchment);           /* Light text on dark background */
  font-variant-caps: small-caps;
  letter-spacing: 0.05em;
  font-weight: 500;
}

tbody tr:nth-child(even) td {
  background: var(--vellum);          /* Subtle alternating rows */
}

/* Ensure good contrast for all table text */
tbody td {
  color: var(--ink-primary);
  background-color: var(--parchment); /* Default row background */
}

/* ===================================================================
   MARGINALIA AND ANNOTATIONS
   =================================================================== */

.marginalia {
  position: absolute;
  right: -20rem;
  width: 18rem;
  
  font-size: 0.85em;
  line-height: 1.4;
  color: var(--ink-tertiary);
  font-style: italic;
  
  /* Classical annotation style */
  font-variant-caps: small-caps;
  letter-spacing: 0.02em;
}

@media (max-width: 1400px) {
  .marginalia {
    position: static;
    float: right;
    clear: right;
    width: 12rem;
    margin: 0 -13rem 1rem 2rem;
  }
}

@media (max-width: 1000px) {
  .marginalia {
    float: none;
    width: auto;
    margin: var(--space-base) 0;
    padding: var(--space-base);
    border-left: 2px solid var(--illumination-blue);
    opacity: 0.3;
  }
}

/* ===================================================================
   FOOTNOTES IN CLASSICAL STYLE
   =================================================================== */

.footnotes {
  margin-top: calc(var(--space-double-golden) * 1.5);
  padding-top: var(--space-double-golden);
  border-top: none;
  font-size: 0.9em;
}

.footnotes::before {
  content: "";
  display: block;
  width: 8rem;
  height: 1px;
  background: var(--illumination-blue);
  opacity: 0.5;
  margin: 0 0 var(--space-golden) 0;
}

.footnotes ol {
  padding-left: 2em;
}

.footnotes ol li {
  text-indent: -1.5em;
  margin-left: 1.5em;
  margin-bottom: var(--space-base);
}

/* Classical footnote references */
.footnote-ref {
  font-size: 0.75em;
  vertical-align: super;
  text-decoration: none;
  color: var(--rubric-red);
  font-variant-numeric: lining-nums;
  font-feature-settings: "lnum" 1;
}

.footnote-ref::before { content: "["; }
.footnote-ref::after { content: "]"; }

/* ===================================================================
   RESPONSIVE REFINEMENTS
   =================================================================== */

@media (max-width: 768px) {
  :root {
    font-size: 17px;
  }
  
  p {
    text-indent: var(--space-base);
  }
  
  blockquote {
    margin: var(--space-golden) var(--space-base);
  }
  
  blockquote::before,
  blockquote::after {
    font-size: 3rem;
  }
}

@media (max-width: 480px) {
  :root {
    font-size: 16px;
  }
  
  .initial-cap::first-letter,
  .dropcap::first-letter {
    font-size: 4rem;
  }
}

/* ===================================================================
   PRINT OPTIMIZATIONS
   =================================================================== */

@media print {
  :root {
    --ink-primary: #000;
    --ink-secondary: #333;
    --parchment: #fff;
    font-size: 11pt;
  }
  
  body {
    color: var(--ink-primary);
    background: var(--parchment);
    line-height: 1.4;
  }
  
  h1, h2, h3 {
    page-break-after: avoid;
    break-after: avoid-page;
  }
  
  blockquote, figure, table {
    page-break-inside: avoid;
    break-inside: avoid;
  }
  
  a {
    color: var(--ink-primary);
    text-decoration: none;
  }
  
  .marginalia {
    position: static;
    float: none;
    width: auto;
    font-size: 0.8em;
    border: 1px solid var(--ink-secondary);
    margin: 0.5em 0;
    padding: 0.5em;
  }
}

/* ===================================================================
   UTILITY CLASSES FOR CLASSICAL TYPOGRAPHY
   =================================================================== */

/* Text variants */
.small-caps { 
  font-variant-caps: small-caps; 
  letter-spacing: 0.05em; 
}

.oldstyle-nums { 
  font-variant-numeric: oldstyle-nums proportional-nums;
  font-feature-settings: "onum" 1, "pnum" 1;
}

.lining-nums { 
  font-variant-numeric: lining-nums tabular-nums;
  font-feature-settings: "lnum" 1, "tnum" 1;
}

/* Classical emphasis */
.emphasis-subtle {
  font-style: italic;
  font-weight: 450;
  color: var(--ink-secondary);
}

.emphasis-strong {
  font-variant-caps: small-caps;
  letter-spacing: 0.05em;
  color: var(--rubric-red);
}

/* Spacing utilities based on classical proportions */
.space-golden { margin: var(--space-golden) 0; }
.space-double { margin: var(--space-double-golden) 0; }
.space-hair { margin: var(--space-hair) 0; }

/* Text alignments */
.text-center { text-align: center; text-indent: 0; }
.text-right { text-align: right; text-indent: 0; }
.no-indent { text-indent: 0; }
.no-justify { text-align: left; hyphens: none; }

/* Classical versals and initials */
.versal {
  font-variant-caps: small-caps;
  letter-spacing: 0.08em;
  font-weight: 500;
  color: var(--rubric-red);
}

.rubric {
  color: var(--rubric-red);
  font-variant-caps: small-caps;
  letter-spacing: 0.05em;
}

/* Rimuove dropcap dopo titoli di livello 1 (# Titolo) */
h1 + p::first-letter {
  float: none !important;
  font-size: inherit !important;
  line-height: inherit !important;
  margin: 0 !important;
  font-weight: inherit !important;
}

/* === NO dropcap per il primissimo paragrafo dopo il titolo di pagina (H1) === */
.quarto-title-block + .content > p:first-of-type::first-letter,
#title-block-header + .content > p:first-of-type::first-letter,
.page-layout-article .content > p:first-of-type::first-letter,
.page-layout-home .content > p:first-of-type::first-letter,
.homefront .content > p:first-of-type::first-letter {
  float: none !important;
  initial-letter: unset !important;        /* per Safari/WebKit */
  -webkit-initial-letter: unset !important;
  font-size: inherit !important;
  line-height: inherit !important;
  margin: 0 !important;
  padding: 0 !important;
  font-weight: inherit !important;
}

